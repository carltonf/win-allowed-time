!function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){function getPrefixStr(){return"net user "+($("#username").val()||"UserName")+" /time:"}function reset(){timeGrid.reset(),$("textarea#script").val(getPrefixStr()).trigger("change")}function updateScript(){var timeStr=timeGrid.gridData.serialize(),prefixStr=getPrefixStr(),res="";res=timeStr?prefixStr+"^\n"+timeStr.split(";").join(";^\n"):prefixStr,$("textarea#script").val(res).trigger("change")}var $=require("jquery"),timeGrid=app.timeGrid;exports.reset=reset,$("button#reset-grid").click(reset),$("#draw>svg g.tile-group-grid").mouseup(updateScript),exports.updateScript=updateScript,$("button#edit").one("click",function(e){$(this).text("Editing...").attr("disabled",!0),$("textarea#script").removeAttr("readonly")});var $scriptDownloadLink=null;$("textarea#script").on("change",function(){$scriptDownloadLink&&(window.URL.revokeObjectURL($scriptDownloadLink.attr("href")),$scriptDownloadLink=null)}),$("button#download").click(function(){if(!$scriptDownloadLink){var scriptBlobURL=window.URL.createObjectURL(new Blob([$("textarea#script").val().split("\n").join("\r\n")],{type:"text/plain"}));$scriptDownloadLink=$("<a>").attr("href",scriptBlobURL).attr("download","allowedTime.bat")}$scriptDownloadLink[0].click()})},{jquery:"jquery"}],2:[function(require,module,exports){function GridModal(){function dataGen(){for(var tileGroup=[],i=0;7>i;i++){for(var weekTileGroup=[],j=0;24>j;j++)weekTileGroup.push(new TileModal(i,j,WEEKDAYS[i],j));tileGroup.push(weekTileGroup)}return tileGroup}function getTileGroup(startTile,endTile){function extent(m,n){return n>m?[m,n]:[n,m]}var srow=extent(startTile.row,endTile.row)[0],erow=extent(startTile.row,endTile.row)[1],scol=extent(startTile.col,endTile.col)[0],ecol=extent(startTile.col,endTile.col)[1];return self.grid.slice(srow,erow+1).reduce(function(group,row){return group.concat(row.slice(scol,ecol+1))},[])}function toJSON(){return self.grid.map(function(row){return row.map(function(tile){return tile.toJSON()})})}function fromJSON(data){var restorep=fromJSON.caller===fromJSON,backup=null;restorep||(backup=self.toJSON());try{for(var i=0;7>i;i++)for(var j=0;24>j;j++)self.grid[i][j].fromJSON(data[i][j])}catch(e){throw restorep||self.fromJSON(backup,!0),e}return self}function serialize(){function getRowTimeSlots(row){var inselected=!1;return row.reduce(function(res,tile){switch(tile.state){case"selected":inselected||(inselected=!0,res.startTimeID=tile.startTimeID,res.push({startTimeID:tile.startTimeID,endTimeID:24}));break;case"unselected":inselected&&(res[res.length-1].endTimeID=tile.startTimeID,inselected=!1);break;default:throw new Error("Tile("+tile.row+", "+tile.col+") State: "+tile.state+" is NOT valid for serialization!")}return res},[])}return self.grid.reduce(function(res,row,idx){var dayTime=getRowTimeSlots(row).map(function(slot){return slot.startTimeID.toString()+":00-"+(slot.endTimeID.toString()+":00")}).join(",");return dayTime&&res.push(WD_ABBRS[idx]+","+dayTime),res},[]).join(";")}function deserialize(serialization){return self.reset(),serialization.split(";").forEach(function(dayStr){var row=null,slotStrs=dayStr.split(",");row=self.grid[WD_ABBRS.indexOf(slotStrs[0])],slotStrs.slice(1).forEach(function(timePeriod){for(var slot=/(\d+):00-(\d+):00/.exec(timePeriod).slice(1,3).map(Number),i=slot[0];i<slot[1];i++)row[i].state="selected"})}),this}function reset(){self.grid.forEach(function(row){row.forEach(function(data){data.state="unselected"})})}function stateTransfer(input,tile){switch(input){case"grouping-start":self.state="grouping",self.stateData=new GroupingState(tile),tile.stateTransfer("grouping"),self.lastUpdatedTiles=[tile];break;case"grouping-move":var curTileGroup=self.getTileGroup(self.stateData.startTile,tile);self.lastUpdatedTiles=xor(curTileGroup,self.stateData.lastTileGroup),self.lastUpdatedTiles.forEach(function(tile){tile.stateTransfer("grouping")}),self.stateData.lastTileGroup=curTileGroup,self.stateData.endTile=tile;break;case"grouping-end":self.lastUpdatedTiles=[],self.stateData.lastTileGroup.forEach(function(tile){tile.stateTransfer("grouping-end"),self.lastUpdatedTiles.push(tile)}),self.state="normal",self.stateData.stateData=null}}var self=this;this.grid=dataGen(),this.getTileGroup=getTileGroup,this.toJSON=toJSON,this.fromJSON=fromJSON,this.serialize=serialize,this.deserialize=deserialize,this.reset=reset,this.state="normal",this.stateData=null,this.stateTransfer=stateTransfer,this.lastUpdatedTiles=null}function GroupingState(st){this.endTile=this.startTile=st,this.lastTileGroup=[this.startTile]}function xor(arrOne,arrTwo){return difference(arrOne,arrTwo).concat(difference(arrTwo,arrOne))}function difference(arrOne,arrTwo){return arrOne.filter(function(elm){return-1===arrTwo.indexOf(elm)})}var WEEKDAYS=require("./commons").WEEKDAYS,WD_ABBRS=require("./commons").WEEKDAY_ABBRS,TileModal=require("./TileModal");module.exports=GridModal},{"./TileModal":3,"./commons":5}],3:[function(require,module,exports){function TileModal(row,col,weekday,startTime){function stateTransfer(input){var validInputs=["grouping","grouping-end"];if(-1===validInputs.indexOf(input))throw new Error("Input: "+input+" is invalid");var stateInputMap={unselected:{grouping:"selecting"},selecting:{grouping:"unselected","grouping-end":"selected"},deselecting:{grouping:"selected","grouping-end":"unselected"},selected:{grouping:"deselecting"}},nextState=stateInputMap[self.state][input];if(!nextState)throw new Error("State: "+self.state+" with "+input+" is invalid!");self.state=nextState}function toJSON(){var exportData={state:self.state};return exportData}function fromJSON(data){if(!data||!data.state)throw new Error(JSON.stringify(data)+" is invalid Tile serialization.");self.state=data.state}var self=this;this.row=row,this.col=col,this.weekdayID=weekday,this.startTimeID=startTime,this.state="unselected",this.stateTransfer=stateTransfer,this.el=null,this.toJSON=toJSON,this.fromJSON=fromJSON}module.exports=TileModal},{}],4:[function(require,module,exports){"use strict";function TimeGrid(){function refreshView(){self.gridData.grid.forEach(function(row){row.forEach(function(data){updateTileView(data.el)})})}function reset(){self.gridData.reset(),self.refreshView()}function serialize(){return self.gridData.serialize()}function deserialize(str){self.gridData.deserialize(str),self.refreshView()}var self=this;this.refreshView=refreshView,this.reset=reset,this.serialize=serialize,this.deserialize=deserialize}function updateTileView(tile){var d3Tile=d3.select(tile),data=d3Tile.datum();d3Tile.classed({"time-tile-selecting":"selecting"===data.state,"time-tile-deselecting":"deselecting"===data.state,"time-tile-selected":"selected"===data.state})}function groupingEndSync(){"grouping"==timeGrid.gridData.state&&timeGrid.emit("grouping-end",this)}var d3=require("d3"),EventEmitter=(require("jquery"),require("events")),WEEKDAYS=require("./commons").WEEKDAYS;TimeGrid.prototype=new EventEmitter;var timeGrid=new TimeGrid,GridModal=require("./GridModal");timeGrid.gridData=new GridModal,timeGrid.on("grouping-start",function(tile){this.gridData.stateTransfer("grouping-start",d3.select(tile).datum()),updateTileView(tile)}).on("grouping-move",function(tile){this.gridData.stateTransfer("grouping-move",d3.select(tile).datum()),this.gridData.lastUpdatedTiles.forEach(function(tileData){updateTileView(tileData.el)})}).on("grouping-end",function(){this.gridData.stateTransfer("grouping-end"),this.gridData.lastUpdatedTiles.forEach(function(tileData){updateTileView(tileData.el)})}),module.exports={create:function(svgSelector,config){var svgDraw=d3.select(svgSelector),gridCanvas=svgDraw.append("g").attr("transform","translate("+config.canvas.ml+", "+config.canvas.mt+")");svgDraw.append("g").attr("class","week-day-label").attr("transform","translate(5, "+config.canvas.mt+")").selectAll("text").data(WEEKDAYS).enter().append("text").text(function(d){return d}).attr("x",config.canvas.ml).attr("dx","-1em").attr("y",function(d,idx){return(config.tile.h+config.tile.mb)*idx}).attr("dy","1em").attr("text-anchor","end"),svgDraw.append("g").attr("class","time-unit-label").attr("transform","translate("+config.canvas.ml+", "+config.canvas.mt+")").selectAll("text").data(Array(24)).enter().append("text").text(function(_,i){return i}).attr("text-anchor","middle").attr("dy","-7").attr("x",function(_,i){return(config.tile.w+config.tile.mr)*i});var legends=svgDraw.append("g").attr("class","grid-legends").attr("transform","translate("+config.canvas.ml+", "+(config.canvas.mt+7*(config.tile.h+config.tile.mb)+config.legend.mt)+")"),singleLegend=legends.append("g");return singleLegend.append("rect").attr("width",config.legend.w).attr("height",config.legend.h).attr("class","time-tile time-tile-selected"),singleLegend.append("text").text("Allowed").attr("x",config.legend.w).attr("dx","7").attr("y",config.legend.h).attr("dy","-2"),singleLegend=legends.append("g").attr("transform","translate("+6.5*config.legend.w+",0)"),singleLegend.append("rect").attr("width",config.legend.w).attr("height",config.legend.h).attr("class","time-tile"),singleLegend.append("text").text("Forbidden").attr("x",config.legend.w).attr("dx","7").attr("y",config.legend.h).attr("dy","-2"),gridCanvas.append("g").attr("class","tile-group-grid").selectAll("g").data(timeGrid.gridData.grid).enter().append("g").attr("class","week-tile-group-grid").attr("transform",function(_,idx){return"translate(0, "+(config.tile.h+config.tile.mb)*idx+")"}).each(function(d,idx){d3.select(this).selectAll("rect").data(d).enter().append("rect").attr("class","time-tile").attr("x",function(d){return(config.tile.w+config.tile.mr)*d.startTimeID}).attr("width",config.tile.w).attr("height",config.tile.h).each(function(d){d.el=this})}),svgDraw.on("click",function(){d3.event.preventDefault()}),d3.selectAll(".tile-group-grid rect").on("mousedown.grouping-start",function(){var LEFT_MOUSE_BUTTON=1;d3.event.which==LEFT_MOUSE_BUTTON&&(d3.event.preventDefault(),timeGrid.emit("grouping-start",this))}).on("mouseenter.grouping-move",function(d,i){"grouping"==timeGrid.gridData.state&&timeGrid.emit("grouping-move",this)}).on("mouseup.grouping-end",groupingEndSync),svgDraw.on("mouseup.grouping-end",groupingEndSync),svgDraw.on("mouseleave.grouping-end",groupingEndSync),timeGrid}}},{"./GridModal":2,"./commons":5,d3:"d3",events:"events",jquery:"jquery"}],5:[function(require,module,exports){exports.WEEKDAYS=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],exports.WEEKDAY_ABBRS=["M","T","W","Th","F","Sa","Su"]},{}],6:[function(require,module,exports){exports.svgConfig={w:715,h:300},exports.gridConfig={canvas:{mt:35,ml:65},tile:{w:25,h:25,mr:1,mb:1},legend:{w:16,h:16,mt:36}}},{}],7:[function(require,module,exports){var $=require("jquery"),WeekHourGrid=require("./WeekHourGrid"),configs=require("./configs");window.app={},$(function(){function updateWebStorage(){var data=timeGrid.serialize();if(data){var username=$("#username").val()||"UserName";storageDevice.setItem(username,data),storageDevice.setItem("*last*",username)}}function loadUserData(username){var userData=storageDevice.getItem(username);return userData?(timeGrid.deserialize(userData),$("input#username").val(username),app.controls.updateScript(),!0):!1}$("svg").attr("width",configs.svgConfig.w).attr("height",configs.svgConfig.h);var timeGrid=WeekHourGrid.create("#draw > svg",configs.gridConfig);app.timeGrid=timeGrid,app.controls=require("./AppControls");var storageDevice=sessionStorage;app.storageDevice=storageDevice,$("textarea#script").change(updateWebStorage),loadUserData(storageDevice.getItem("*last*"));for(var i=0;i<storageDevice.length;i++){var username=storageDevice.key(i);username&&"*last*"!=username&&$("<option>").attr("value",username).appendTo("datalist#savedUserNames")}$("input#username").change(function(e){var name=$(this).val();loadUserData(name)||app.controls.reset()})})},{"./AppControls":1,"./WeekHourGrid":4,"./configs":6,jquery:"jquery"}]},{},[7]);
